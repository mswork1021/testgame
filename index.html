<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a2e">
    <title>Tap Quest - タップクエスト</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="game-container">
        <!-- ヘッダー：リソース表示 -->
        <header id="header">
            <div class="resource-bar">
                <div class="resource gold">
                    <span class="icon">💰</span>
                    <span id="gold-display">0</span>
                </div>
                <div class="resource souls">
                    <span class="icon">👻</span>
                    <span id="souls-display">0</span>
                </div>
                <div class="resource gems">
                    <span class="icon">💎</span>
                    <span id="gems-display">0</span>
                </div>
                <div class="header-icons">
                    <button id="achievements-btn" class="header-icon-btn" title="実績">🏆</button>
                    <button id="settings-btn" class="header-icon-btn" title="設定">⚙️</button>
                </div>
            </div>
            <div class="stage-info">
                <span id="stage-display">ステージ 1-1</span>
                <div class="progress-bar">
                    <div id="stage-progress" class="progress-fill"></div>
                </div>
            </div>
        </header>

        <!-- メインバトルエリア -->
        <main id="battle-area">
            <div id="boss-timer" class="hidden">
                <span class="timer-icon">⏱️</span>
                <span id="boss-time-left">30</span>
            </div>

            <!-- 召喚キャラ表示エリア（左） -->
            <div id="summoned-heroes-left" class="summoned-heroes-side left"></div>

            <div id="monster-container">
                <div id="monster-hp-bar">
                    <div id="monster-hp-fill"></div>
                    <span id="monster-hp-text">100/100</span>
                </div>
                <div id="monster" class="monster">
                    <div id="monster-emoji" class="monster-svg"></div>
                </div>
                <div id="monster-name">スライム</div>
            </div>

            <!-- 召喚キャラ表示エリア（右） -->
            <div id="summoned-heroes-right" class="summoned-heroes-side right"></div>

            <div id="damage-numbers"></div>
            <div id="loot-popup" class="hidden"></div>
        </main>

        <!-- パネル最小化トグル -->
        <button id="panel-toggle" class="panel-toggle">
            <span class="toggle-icon">▼</span>
        </button>

        <!-- 下部ナビゲーション -->
        <nav id="bottom-nav">
            <button class="nav-btn active" data-tab="heroes">
                <span class="nav-icon">🥋</span>
                <span class="nav-label">修行</span>
            </button>
            <button class="nav-btn" data-tab="equipment">
                <span class="nav-icon">🛡️</span>
                <span class="nav-label">装備</span>
            </button>
            <button class="nav-btn" data-tab="skills">
                <span class="nav-icon">✨</span>
                <span class="nav-label">スキル</span>
            </button>
            <button class="nav-btn" data-tab="collection">
                <span class="nav-icon">📚</span>
                <span class="nav-label">図鑑</span>
            </button>
            <button class="nav-btn" data-tab="rebirth">
                <span class="nav-icon">🔄</span>
                <span class="nav-label">転生</span>
            </button>
            <button class="nav-btn" data-tab="summon">
                <span class="nav-icon">🌟</span>
                <span class="nav-label">召喚</span>
            </button>
            <button class="nav-btn" data-tab="missions">
                <span class="nav-icon">📋</span>
                <span class="nav-label">任務</span>
            </button>
            <button class="nav-btn" data-tab="shop">
                <span class="nav-icon">🛒</span>
                <span class="nav-label">ショップ</span>
            </button>
            <button class="nav-btn" data-tab="tower">
                <span class="nav-icon">🗼</span>
                <span class="nav-label">塔</span>
            </button>
        </nav>

        <!-- タブパネル -->
        <div id="tab-panels">
            <!-- 修行タブ -->
            <div id="heroes-panel" class="tab-panel active">
                <div class="panel-header">
                    <h2>修行場</h2>
                    <div class="dps-display">DPS: <span id="total-dps">0</span></div>
                </div>
                <div id="heroes-list" class="upgrade-list"></div>
            </div>

            <!-- 装備タブ -->
            <div id="equipment-panel" class="tab-panel">
                <div class="equipment-slots">
                    <div class="equip-slot" data-slot="weapon">
                        <div class="slot-icon">⚔️</div>
                        <div class="slot-label">武器</div>
                        <div id="weapon-slot" class="slot-item empty">なし</div>
                    </div>
                    <div class="equip-slot" data-slot="armor">
                        <div class="slot-icon">🛡️</div>
                        <div class="slot-label">防具</div>
                        <div id="armor-slot" class="slot-item empty">なし</div>
                    </div>
                    <div class="equip-slot" data-slot="accessory">
                        <div class="slot-icon">💍</div>
                        <div class="slot-label">アクセ</div>
                        <div id="accessory-slot" class="slot-item empty">なし</div>
                    </div>
                </div>
                <div class="inventory-header">
                    <h3>所持品 <span id="inventory-count"></span></h3>
                    <div class="inventory-actions">
                        <button id="sort-inventory-btn" class="inv-btn">並替</button>
                        <button id="sell-common-btn" class="inv-btn sell">売却</button>
                    </div>
                </div>
                <div id="inventory-list" class="inventory-grid"></div>
            </div>

            <!-- スキルタブ -->
            <div id="skills-panel" class="tab-panel">
                <div class="panel-header">
                    <h2>アクティブスキル</h2>
                </div>
                <div id="skills-list" class="skills-grid"></div>

                <div class="panel-header skill-tree-header">
                    <h2>🌳 スキルツリー</h2>
                    <div class="skill-points-display">SP: <span id="skill-points">0</span></div>
                </div>
                <div id="skill-tree-container" class="skill-tree-grid"></div>
            </div>

            <!-- 図鑑タブ -->
            <div id="collection-panel" class="tab-panel">
                <div class="panel-header">
                    <h2>📚 図鑑</h2>
                    <div class="collection-progress-display">
                        <span id="collection-progress">0</span>/<span id="collection-total">0</span>
                    </div>
                </div>
                <div class="collection-tabs">
                    <button class="collection-tab active" data-collection="monsters">🐾 モンスター</button>
                    <button class="collection-tab" data-collection="equipment">⚔️ 装備</button>
                </div>
                <div id="collection-content" class="collection-grid"></div>
            </div>

            <!-- 転生タブ -->
            <div id="rebirth-panel" class="tab-panel">
                <div class="panel-header">
                    <h2>転生</h2>
                </div>
                <div class="rebirth-info">
                    <div class="rebirth-stats">
                        <p>現在のステージ: <span id="current-stage-rebirth">1</span></p>
                        <p>転生回数: <span id="rebirth-count">0</span></p>
                        <p>獲得予定ソウル: <span id="pending-souls">0</span> 👻</p>
                        <p>獲得予定SP: <span id="pending-sp">0</span> ✨</p>
                    </div>
                    <button id="rebirth-btn" class="rebirth-button" disabled>
                        転生する<br>
                        <small>(ステージ50以上で解放)</small>
                    </button>
                </div>

                <!-- アーティファクトセクション -->
                <div class="artifacts-section">
                    <div class="panel-header">
                        <h3>🏺 アーティファクト</h3>
                        <div class="souls-display">👻 <span id="artifact-souls">0</span></div>
                    </div>
                    <p class="artifacts-description">ソウルを使って永続的なボーナスを獲得</p>
                    <div id="artifacts-list" class="artifacts-grid"></div>
                </div>
            </div>

            <!-- 召喚タブ -->
            <div id="summon-panel" class="tab-panel">
                <div class="panel-header summon-header">
                    <h2>🌟 仲間召喚</h2>
                    <div class="gems-display">💎 <span id="summon-gems">0</span></div>
                </div>

                <!-- 召喚バナー -->
                <div class="summon-banner">
                    <div class="banner-title">★ 仲間ガチャ ★</div>
                    <div class="banner-rates">
                        <span class="rate rate-common">★50%</span>
                        <span class="rate rate-uncommon">★★30%</span>
                        <span class="rate rate-rare">★★★14%</span>
                        <span class="rate rate-epic">★★★★5%</span>
                        <span class="rate rate-legendary">★★★★★1%</span>
                    </div>
                </div>

                <!-- 天井カウンター -->
                <div class="pity-counter">
                    <div class="pity-info">
                        <span>天井まで: <strong id="pity-count">0</strong>/100</span>
                        <span class="pity-note">※100連で★★★★★確定</span>
                    </div>
                    <div class="pity-bar">
                        <div id="pity-fill" class="pity-fill"></div>
                    </div>
                </div>

                <!-- 召喚ボタン -->
                <div class="summon-buttons">
                    <button id="summon-single-btn" class="summon-btn single">
                        <span class="summon-btn-title">単発召喚</span>
                        <span class="summon-btn-cost">💎 5</span>
                    </button>
                    <button id="summon-multi-btn" class="summon-btn multi">
                        <span class="summon-btn-title">10連召喚</span>
                        <span class="summon-btn-cost">💎 45</span>
                        <span class="summon-btn-bonus">+1回ボーナス!</span>
                    </button>
                </div>

                <!-- 所持キャラ一覧 -->
                <div class="owned-heroes-section">
                    <div class="panel-header">
                        <h3>所持キャラ</h3>
                        <span id="owned-heroes-count">0/13</span>
                    </div>
                    <div id="owned-heroes-list" class="owned-heroes-grid"></div>
                </div>
            </div>

            <!-- 任務タブ -->
            <div id="missions-panel" class="tab-panel">
                <div class="panel-header">
                    <h2>📋 デイリー任務</h2>
                    <div class="missions-progress">
                        <span id="missions-completed">0</span>/<span id="missions-total">6</span> 完了
                    </div>
                </div>

                <!-- 任務リスト -->
                <div id="missions-list" class="missions-list"></div>

                <!-- 全クリアボーナス -->
                <div id="missions-bonus" class="missions-bonus">
                    <div class="bonus-info">
                        <span class="bonus-icon">🎁</span>
                        <span class="bonus-text">全任務クリアボーナス</span>
                    </div>
                    <div class="bonus-reward">
                        <span>💎 20</span>
                    </div>
                    <button id="claim-all-bonus" class="btn-claim" disabled>受取</button>
                </div>

                <p class="missions-reset-note">※ 毎日0:00にリセットされます</p>
            </div>

            <!-- ショップタブ -->
            <div id="shop-panel" class="tab-panel">
                <div class="panel-header">
                    <h2>🛒 ショップ</h2>
                    <div class="shop-gems">
                        💎 <span id="shop-gems-display">0</span>
                    </div>
                </div>

                <!-- 週間パス -->
                <div class="shop-section" id="weekly-pass-section">
                    <h3>📅 週間パス</h3>
                    <div id="weekly-pass-content"></div>
                </div>

                <!-- 特別パック -->
                <div class="shop-section">
                    <h3>🎁 特別パック</h3>
                    <div id="special-packs-list" class="shop-packs-grid"></div>
                </div>

                <!-- ジェムパック -->
                <div class="shop-section">
                    <h3>💎 ジェム購入</h3>
                    <div id="gem-packs-list" class="shop-packs-grid"></div>
                </div>

                <p class="shop-note">※ 現在テストモードです。実際の課金は発生しません。</p>
            </div>

            <!-- 無限の塔タブ -->
            <div id="tower-panel" class="tab-panel">
                <div class="panel-header">
                    <h2>🗼 無限の塔</h2>
                    <div class="tower-medals-display">
                        🏅 <span id="tower-medals">0</span>
                    </div>
                </div>

                <!-- 塔情報 -->
                <div class="tower-info-card">
                    <div class="tower-floor-display">
                        <span class="floor-label">現在の階層</span>
                        <span id="tower-current-floor" class="floor-number">1F</span>
                    </div>
                    <div class="tower-stats-row">
                        <span>最高到達: <span id="tower-max-floor">0</span>F</span>
                        <span>残り挑戦: <span id="tower-attempts">3</span>回</span>
                    </div>
                </div>

                <!-- 次の報酬 -->
                <div class="tower-reward-preview">
                    <h3>クリア報酬</h3>
                    <div id="tower-next-reward" class="tower-rewards">
                        <span class="reward-item">🏅 1</span>
                    </div>
                </div>

                <!-- 挑戦中メッセージ（挑戦中のみ表示） -->
                <div id="tower-battle-area" class="tower-in-progress hidden">
                    <div class="tower-tap-message">
                        <span class="tap-icon">👆</span>
                        <p>上のバトル画面をタップして<br>ボスを倒せ！</p>
                    </div>
                    <button id="tower-abandon-btn" class="btn-danger">諦める</button>
                </div>

                <!-- コントロール（挑戦前のみ表示） -->
                <div id="tower-controls" class="tower-controls">
                    <button id="tower-start-btn" class="tower-start-btn">
                        <span class="btn-icon">⚔️</span>
                        <span>挑戦する</span>
                    </button>
                    <button id="tower-buy-attempt-btn" class="tower-buy-btn">
                        <span>追加挑戦</span>
                        <span class="cost">💎 10</span>
                    </button>
                </div>

                <p class="tower-note">※ 挑戦回数は毎日0:00にリセット</p>

                <!-- 塔交換所 -->
                <div class="tower-shop-section">
                    <h3>🏅 メダル交換所</h3>
                    <div id="tower-shop-list" class="tower-shop-grid"></div>
                </div>
            </div>
        </div>

        <!-- 召喚結果モーダル -->
        <div id="summon-result-modal" class="modal hidden">
            <div class="modal-content summon-result-content">
                <div id="summon-result-display" class="summon-result-display"></div>
                <button id="close-summon-result" class="btn-primary">OK</button>
            </div>
        </div>

        <!-- キャラ詳細モーダル -->
        <div id="hero-detail-modal" class="modal hidden">
            <div class="modal-content hero-detail-content">
                <div id="hero-detail-header" class="hero-detail-header">
                    <div id="hero-detail-image" class="hero-detail-image"></div>
                    <div class="hero-detail-info">
                        <h2 id="hero-detail-name">キャラ名</h2>
                        <div id="hero-detail-stars" class="hero-detail-stars">★</div>
                        <div id="hero-detail-level" class="hero-detail-level">Lv.1</div>
                    </div>
                </div>
                <p id="hero-detail-desc" class="hero-detail-description">説明文</p>
                <div id="hero-detail-stats" class="hero-detail-stats">
                    <!-- 動的に生成 -->
                </div>
                <div id="hero-detail-dupe" class="hero-detail-dupe-info">
                    <!-- 動的に生成 -->
                </div>
                <div class="hero-detail-battle-toggle">
                    <label>
                        <input type="checkbox" id="hero-battle-toggle"> バトル画面に表示 (最大6体)
                    </label>
                </div>
                <button id="close-hero-detail" class="btn-primary">閉じる</button>
            </div>
        </div>

        <!-- オフライン報酬モーダル -->
        <div id="offline-modal" class="modal hidden">
            <div class="modal-content">
                <h2>おかえりなさい！</h2>
                <p>離れている間に...</p>
                <div class="offline-rewards">
                    <p>💰 <span id="offline-gold">0</span> ゴールド獲得！</p>
                </div>
                <button id="claim-offline" class="btn-primary">受け取る</button>
                <button id="claim-offline-double" class="btn-secondary">広告を見て2倍</button>
            </div>
        </div>

        <!-- 装備詳細モーダル -->
        <div id="equipment-modal" class="modal hidden">
            <div class="modal-content">
                <h2 id="equip-modal-title">装備名</h2>
                <div id="equip-modal-stats"></div>
                <div class="modal-buttons">
                    <button id="equip-btn" class="btn-primary">装備する</button>
                    <button id="close-equip-modal" class="btn-secondary">閉じる</button>
                </div>
            </div>
        </div>

        <!-- デイリーログインボーナスモーダル -->
        <div id="daily-modal" class="modal hidden">
            <div class="modal-content daily-bonus-modal">
                <h2>🎁 デイリーボーナス</h2>
                <p class="login-streak">連続ログイン: <span id="login-streak">1</span>日目</p>
                <div class="daily-rewards-grid" id="daily-rewards-grid"></div>
                <button id="claim-daily" class="btn-primary btn-glow">報酬を受け取る</button>
            </div>
        </div>

        <!-- ストーリーモーダル -->
        <div id="story-modal" class="modal hidden">
            <div class="modal-content story-modal">
                <div class="story-header">
                    <h2 id="story-chapter-title">第1章：冒険の始まり</h2>
                </div>
                <div class="story-scene">
                    <div class="story-character">
                        <span id="story-character-emoji" class="character-emoji">🧚</span>
                        <span id="story-character-name" class="character-name">ガイド妖精</span>
                    </div>
                    <div id="story-text" class="story-text">ようこそ、勇者様！</div>
                </div>
                <div class="story-controls">
                    <button id="story-next-btn" class="btn-primary">次へ ▶</button>
                </div>
            </div>
        </div>

        <!-- ストーリーリストモーダル -->
        <div id="story-list-modal" class="modal hidden">
            <div class="modal-content story-list-modal">
                <div class="story-list-header">
                    <h2>📖 ストーリー</h2>
                    <button id="close-story-list" class="close-btn">✕</button>
                </div>
                <div id="story-chapter-list" class="story-chapter-list"></div>
            </div>
        </div>

        <!-- 設定モーダル -->
        <div id="settings-modal" class="modal hidden">
            <div class="modal-content settings-modal-content">
                <div class="modal-header">
                    <h2>⚙️ 設定</h2>
                    <button id="close-settings" class="close-btn">✕</button>
                </div>

                <!-- サウンド設定 -->
                <div class="settings-section-modal">
                    <h3>🔊 サウンド</h3>
                    <div class="sound-settings">
                        <div class="sound-setting-row">
                            <span class="sound-label">🔊 マスター</span>
                            <input type="range" id="master-volume" min="0" max="100" value="50" class="volume-slider">
                            <button id="mute-btn" class="sound-btn">🔊</button>
                        </div>
                        <div class="sound-setting-row">
                            <span class="sound-label">🎵 BGM</span>
                            <input type="range" id="bgm-volume" min="0" max="100" value="30" class="volume-slider">
                            <button id="bgm-toggle-btn" class="sound-btn">OFF</button>
                        </div>
                        <div class="sound-setting-row">
                            <span class="sound-label">🔔 SE</span>
                            <input type="range" id="sfx-volume" min="0" max="100" value="70" class="volume-slider">
                        </div>
                    </div>
                </div>

                <!-- その他設定 -->
                <div class="settings-section-modal">
                    <h3>📱 その他</h3>
                    <div class="settings-buttons">
                        <button id="refresh-btn" class="settings-btn refresh">
                            🔄 更新
                        </button>
                        <button id="reset-btn" class="settings-btn danger">
                            🗑️ リセット
                        </button>
                    </div>
                    <p class="save-note">※ 自動セーブ: 30秒ごと / ページ離脱時</p>
                </div>
            </div>
        </div>

        <!-- 実績モーダル -->
        <div id="achievements-modal" class="modal hidden">
            <div class="modal-content achievements-modal-content">
                <div class="modal-header">
                    <h2>🏆 実績</h2>
                    <button id="close-achievements" class="close-btn">✕</button>
                </div>
                <div class="achievements-progress">
                    <span id="modal-unlocked-achievements">0</span>/<span id="modal-total-achievements">0</span> 達成
                </div>
                <div id="modal-achievements-list" class="achievements-grid"></div>
            </div>
        </div>
    </div>

    <script src="js/data.js"></script>
    <script src="js/sound.js"></script>
    <script src="js/game.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/save.js"></script>
    <script src="js/main.js"></script>
    <div id="debug-version" style="position:fixed;bottom:5px;left:5px;font-size:10px;color:#666;z-index:9999;">v2.37</div>
</body>
</html>
